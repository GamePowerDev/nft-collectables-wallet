{"ast":null,"code":"// Copyright 2017-2021 @polkadot/rpc-core authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { asapScheduler, Observable, Subscription } from '@polkadot/x-rxjs';\n/** @internal */\n\nexport function refCountDelay() {\n  var delay = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1750;\n  return function (source) {\n    // state: 0 = disconnected, 1 = disconnecting, 2 = connecting, 3 = connected\n    var _ref = [0, 0, Subscription.EMPTY, Subscription.EMPTY],\n        state = _ref[0],\n        refCount = _ref[1],\n        connection = _ref[2],\n        scheduler = _ref[3];\n    return new Observable(function (ob) {\n      source.subscribe(ob);\n\n      if (refCount++ === 0) {\n        if (state === 1) {\n          scheduler.unsubscribe();\n        } else {\n          connection = source.connect();\n        }\n\n        state = 3;\n      }\n\n      return function () {\n        if (--refCount === 0) {\n          if (state === 2) {\n            state = 0;\n            scheduler.unsubscribe();\n          } else {\n            // state === 3\n            state = 1;\n            scheduler = asapScheduler.schedule(function () {\n              state = 0;\n              connection.unsubscribe();\n            }, delay);\n          }\n        }\n      };\n    });\n  };\n}","map":null,"metadata":{},"sourceType":"module"}