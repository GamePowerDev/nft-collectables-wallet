{"ast":null,"code":"import _slicedToArray from \"/Users/michaelhuntington/Documents/GitHub/nft-collectibles-wallet/api/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n// Copyright 2017-2021 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nimport { combineLatest, of } from '@polkadot/x-rxjs';\nimport { map, switchMap } from '@polkadot/x-rxjs/operators';\nimport { deriveCache, memo } from \"../util/index.js\";\nvar CACHE_KEY = 'eraExposure';\n\nfunction mapStakers(era, stakers) {\n  var nominators = {};\n  var validators = {};\n  stakers.forEach(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n        key = _ref2[0],\n        exposure = _ref2[1];\n\n    var validatorId = key.args[1].toString();\n    validators[validatorId] = exposure;\n    exposure.others.forEach(function (_ref3, validatorIndex) {\n      var who = _ref3.who;\n      var nominatorId = who.toString();\n      nominators[nominatorId] = nominators[nominatorId] || [];\n      nominators[nominatorId].push({\n        validatorId: validatorId,\n        validatorIndex: validatorIndex\n      });\n    });\n  });\n  return {\n    era: era,\n    nominators: nominators,\n    validators: validators\n  };\n}\n\nexport function _eraExposure(instanceId, api) {\n  return memo(instanceId, function (era, withActive) {\n    var cacheKey = \"\".concat(CACHE_KEY, \"-\").concat(era.toString());\n    var cached = withActive ? undefined : deriveCache.get(cacheKey);\n    return cached ? of(cached) : api.query.staking.erasStakersClipped.entries(era).pipe(map(function (stakers) {\n      var value = mapStakers(era, stakers);\n      !withActive && deriveCache.set(cacheKey, value);\n      return value;\n    }));\n  });\n}\nexport function eraExposure(instanceId, api) {\n  return memo(instanceId, function (era) {\n    return api.derive.staking._eraExposure(era, true);\n  });\n}\nexport function _erasExposure(instanceId, api) {\n  return memo(instanceId, function (eras, withActive) {\n    return eras.length ? combineLatest(eras.map(function (era) {\n      return api.derive.staking._eraExposure(era, withActive);\n    })) : of([]);\n  });\n}\nexport function erasExposure(instanceId, api) {\n  return memo(instanceId, function () {\n    var withActive = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return api.derive.staking.erasHistoric(withActive).pipe(switchMap(function (eras) {\n      return api.derive.staking._erasExposure(eras, withActive);\n    }));\n  });\n}","map":null,"metadata":{},"sourceType":"module"}